# =============================================================
# Tibetant MakefileMacOS
# =============================================================

EXE_NAME = Tibetant

# make sure these are in your path
#
CC          = clang
C++         = clang++
LD          = clang++

SRCDIR := .
DSTDIR := .

GLFW_DIR = /Users/malartrebenjamin/Documents/RnD/glfw/build
GL3W_DIR = $(SRCDIR)/gl3w
IMGUI_DIR = $(SRCDIR)/imgui

# settings
#
CFLAGS = -DPLATFORM_DARWIN \
  -DCC_GNU_ \
  -DOSMac_ \
  -DOSMacOSX_ \
  -DOSMac_MachO_ \
  -D__MACOSX_CORE__\
  -D__LITTLE_ENDIAN__\
  -O3 \
  -D_LANGUAGE_C_PLUS_PLUS\
  -mmacosx-version-min=10.9\
  -arch x86_64\
  -fPIC\
  -DNDEBUG\
  -static

C++FLAGS = $(CFLAGS) \
  -std=c++11 \
  -stdlib=libc++ \
  -fno-gnu-keywords \
  -fpascal-strings  \
  -Wno-deprecated \
  -Wpointer-arith \
  -Wwrite-strings \
  -Wno-long-long

# includes
#
STK_INCLUDES = ../../include
INCLUDES = -I$(GL3W_DIR) -I$(IMGUI_DIR) -I$(GLFW_DIR)/include -I$(STK_INCLUDES) -I$(SRCDIR) 

# sources
#
STK_PATH = ../../src

LIBS += -lm
LIBS += -framework CoreFoundation
LIBS += -framework AudioToolbox
LIBS += -framework AudioUnit
LIBS += -framework CoreAudio
LIBS += -framework CoreAudioKit
LIBS += -framework CoreMIDI
LIBS += -framework CoreMIDIServer
LIBS += -framework Cocoa
LIBS += -framework IOKit
LIBS += -framework OpenGL
LIBS += $(GLFW_DIR)/src/libglfw3.a


LIBS_PATH =

LDFLAGS += $(LIBS)

# infos
#
MSG1 = "== Compile $(EXE_NAME)"
MSG2 = "==  CC      $(CC)"
MSG3 = "==  C++     $(C++)"

# deploy
#
DEST = $(DSTDIR)

# variable definitions
#
#SOURCES = $(GL3W_DIR)/gl3w.cpp
SOURCES = $(IMGUI_DIR)/imgui.cpp
SOURCES += $(IMGUI_DIR)/imgui_stdlib.cpp
SOURCES += $(IMGUI_DIR)/imgui_impl_glfw.cpp
SOURCES += $(IMGUI_DIR)/imgui_impl_opengl3.cpp
SOURCES += $(IMGUI_DIR)/imgui_draw.cpp
SOURCES += $(IMGUI_DIR)/imgui_widgets.cpp
SOURCES += $(IMGUI_DIR)/imgui_tables.cpp
SOURCES += $(IMGUI_DIR)/imgui_demo.cpp
SOURCES += $(IMGUI_DIR)/imgui_knobs.cpp
SOURCES += $(IMGUI_DIR)/imgui_plot.cpp
SOURCES += $(IMGUI_DIR)/implot.cpp
SOURCES += $(IMGUI_DIR)/implot_items.cpp
SOURCES += $(IMGUI_DIR)/implot_demo.cpp
SOURCES += $(STK_PATH)/Stk.cpp
SOURCES += $(STK_PATH)/BeeThree.cpp
SOURCES += $(STK_PATH)/Noise.cpp
SOURCES += $(STK_PATH)/Blit.cpp
SOURCES += $(STK_PATH)/BlitSaw.cpp
SOURCES += $(STK_PATH)/BlitSquare.cpp
SOURCES += $(STK_PATH)/Modulate.cpp
SOURCES += $(STK_PATH)/Granulate.cpp
SOURCES += $(STK_PATH)/FileRead.cpp
SOURCES += $(STK_PATH)/FileWvIn.cpp
SOURCES += $(STK_PATH)/FileLoop.cpp
SOURCES += $(STK_PATH)/ADSR.cpp
SOURCES += $(STK_PATH)/Fir.cpp
SOURCES += $(STK_PATH)/DelayA.cpp
SOURCES += $(STK_PATH)/DelayL.cpp
SOURCES += $(STK_PATH)/SineWave.cpp
SOURCES += $(STK_PATH)/SingWave.cpp
SOURCES += $(STK_PATH)/TwoZero.cpp
SOURCES += $(STK_PATH)/OneZero.cpp
SOURCES += $(STK_PATH)/OnePole.cpp
SOURCES += $(STK_PATH)/Envelope.cpp
SOURCES += $(STK_PATH)/Twang.cpp
SOURCES += $(STK_PATH)/Plucked.cpp
SOURCES += $(STK_PATH)/RtAudio.cpp
SOURCES += $(STK_PATH)/FM.cpp
SOURCES += $(SRCDIR)/parameter.cpp
SOURCES += $(SRCDIR)/node.cpp
SOURCES += $(SRCDIR)/value.cpp
SOURCES += $(SRCDIR)/random.cpp
SOURCES += $(SRCDIR)/generator.cpp
SOURCES += $(SRCDIR)/effect.cpp
SOURCES += $(SRCDIR)/lfo.cpp
SOURCES += $(SRCDIR)/sequencer.cpp
SOURCES += $(SRCDIR)/graph.cpp
SOURCES += $(SRCDIR)/main.cpp

OBJECTS  := $(patsubst %.cpp,$(DSTDIR)/%.o,$(SOURCES))

EXE := $(DSTDIR)/$(EXE_NAME)
MAKEFILE := $(SRCDIR)/MakefileMacOS

# target specific flags.
#
$(OBJECTS): CFLAGS   := $(CFLAGS)
$(OBJECTS): C++FLAGS := $(C++FLAGS)
$(OBJECTS): INCLUDES := $(INCLUDES) -I/usr/X11R6/include

DEPENDS:     INCLUDES := $(INCLUDES)


# rules definitions
#
.PHONY:	all depend clean print test deploy

all:
	 +@make -f $(MAKEFILE) print
	 +@make -f $(MAKEFILE) $(EXE)

print:
	 @echo $(MSG1)
	 @echo $(MSG2)
	 @echo $(MSG3)

test:
	 +@make -f $(SRCDIR)/MakefileMacOS
	 #
	 @echo "_______________________________________________________________"
	 @echo "		Build Tibetant Executable :"
	 @echo "		Here : $(DEST)"
	 #
	 @cp Tibetant $(DEST)

deploy:
	 +@make -f $(SRCDIR)/MakefileMacOS clean
	 +@make -f $(SRCDIR)/MakefileMacOS
	 #
	 @echo "_______________________________________________________________"
	 @echo "		Deploy Tibetant Executable :"
	 @echo "		Here : $(DEST)"
	 #
	 @cp Tibetant $(DEST)

%.o :	%.c
	 $(CC) -c $(INCLUDES) $(CFLAGS) $< -o $@

%.o :	%.cpp
	 @echo INCLUDES : $(INCLUDES)
	 @echo "Compiling $< ..."
	 $(C++) -c $(INCLUDES) $(C++FLAGS) $< -o $@

%.i :	%.cpp
	 $(C++) -E $(INCLUDES) $(C++FLAGS) $*.cpp > $*.i

$(EXE): $(OBJECTS)
	 $(LD) -o $@ $(LDFLAGS) $^ $(LIBS)

depend:
	 makedepend $(INCLUDES) $(MDFLAGS) -f$(MAKEFILE) $(SOURCES)

clean:
	 rm -rf *.o *.gah *.so $(STK_PATH)/*.o $(EXE_NAME)
